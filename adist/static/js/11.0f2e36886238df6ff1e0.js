webpackJsonp([11],{CQGA:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),o=r.n(a),n=r("exGp"),s=r.n(n),i=r("Dd8w"),l=r.n(i),u=r("gyMJ"),c=r("0xDb"),m=r("NYxO"),d=r("sYY+"),f=r.n(d),p={computed:l()({},Object(m.b)({QiuniuToken:function(e){return e.Account.QnInfo.token},QiuniuDomain:function(e){return e.Account.QnInfo.domainName}})),data:function(){return{ruleForm:{attachUrl:"",author:"",columnId:"",richText:"",source:"",status:"",title:"",webName:"",intro:"",coverUrl:""},name:"",names:[],editor:"",fileList:[],rules:{attachUrl:[{required:!0,message:"请上传附件",trigger:"change"}],intro:[{required:!0,message:"请输入简介",trigger:"change"}],author:[{required:!0,message:"请输入作者",trigger:"change"}],columnId:[{required:!0,message:"请选择栏目",trigger:"change"}],richText:[{required:!0,message:"请输入文章内容",trigger:"change"}],source:[{required:!0,message:"请输入文章来源",trigger:"change"}],title:[{required:!0,message:"请输入文章名称",trigger:"change"}],coverUrl:[{required:!0,message:"请选择封面图",trigger:"change"}]}}},created:function(){var e=this;return s()(o.a.mark(function t(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},t,e)}))()},mounted:function(){var e=this;return s()(o.a.mark(function t(){var r,a,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.$route.query.id){t.next=7;break}return t.next=3,u.e.queryMsgDetai(e.$route.query.id);case 3:r=t.sent,a=r.data,e.ruleForm=a,e.names=[{name:a.webName,url:a.attachUrl}];case 7:return t.next=9,u.a.queryQnToken();case 9:n=t.sent,e.$store.commit("Account/QUERY_QTOKEN",n.data),e.editor=new f.a(e.$refs.editor),e.editor.customConfig.uploadImgShowBase64=!1,e.editor.customConfig.showLinkImg=!1,e.editor.customConfig.qiniu=!0,e.editor.create(),e.$route.query.id&&e.editor.txt.html(e.ruleForm.richText),Object(c.a)({token:e.QiuniuToken,domain:e.QiuniuDomain})(e.editor);case 18:case"end":return t.stop()}},t,e)}))()},methods:{createdMsg:function(e){var t=this;return s()(o.a.mark(function r(){return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.ruleForm.richText=t.editor.txt.html(),r.next=3,t.$refs.ruleForm.validate();case 3:return t.ruleForm.status=e,r.next=6,u.e.createdMsg(t.ruleForm);case 6:t.$message.success("成功"),t.$router.push("newMsg");case 8:case"end":return r.stop()}},r,t)}))()},successFile:function(e){this.ruleForm.attachUrl=this.$store.state.Account.QnInfo.domainName+e.key,this.names=[{name:this.ruleForm.webName,url:this.ruleForm.attachUrl}]},successFile1:function(e){this.ruleForm.coverUrl=this.$store.state.Account.QnInfo.domainName+e.key},handleChange:function(e){this.ruleForm.webName=e.name}}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},[r("header-tit",{attrs:{img:"newT.png",tit:"新闻咨询",back:"1"}}),e._v(" "),r("div",{staticClass:"content"},[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-position":"right","label-width":"80px"}},[r("el-form-item",{attrs:{label:"绑定栏目",prop:"columnId"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.columnId,callback:function(t){e.$set(e.ruleForm,"columnId",t)},expression:"ruleForm.columnId"}},e._l(e.$store.state.BaseConfig.colums,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"文章名称",prop:"title"}},[r("el-input",{staticClass:"fi",model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"文章来源",prop:"source"}},[r("el-input",{staticClass:"fi",model:{value:e.ruleForm.source,callback:function(t){e.$set(e.ruleForm,"source",t)},expression:"ruleForm.source"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"作　　者",prop:"author"}},[r("el-input",{staticClass:"fi",model:{value:e.ruleForm.author,callback:function(t){e.$set(e.ruleForm,"author",t)},expression:"ruleForm.author"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"简　　介",prop:"intro"}},[r("el-input",{staticClass:"fi",model:{value:e.ruleForm.intro,callback:function(t){e.$set(e.ruleForm,"intro",t)},expression:"ruleForm.intro"}})],1),e._v(" "),r("div",{staticClass:"to"},[r("el-form-item",{attrs:{prop:"richText",label:"文章内容"}},[r("div",{staticClass:"info"},[r("div",{ref:"editor",staticStyle:{"text-align":"left"}})])])],1),e._v(" "),r("el-form-item",{attrs:{label:"封面图片",prop:"coverUrl"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{data:{token:e.$store.state.Account.QnInfo.token},action:"http://up-z0.qiniu.com","show-file-list":!1,"on-success":e.successFile1}},[e.ruleForm.coverUrl?r("img",{staticClass:"avatar",attrs:{src:e.ruleForm.coverUrl}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"上传附件",prop:"attachUrl"}},[r("el-upload",{staticClass:"upload-demo",attrs:{data:{token:e.$store.state.Account.QnInfo.token},action:"http://up-z0.qiniu.com",limit:1,"on-success":e.successFile,"file-list":e.names,"on-change":e.handleChange}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),e._v(" "),r("div",{staticClass:"bo mar"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.createdMsg("ON")}}},[e._v("保存并签发")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.createdMsg("draft")}}},[e._v("保存文章")])],1)],1)],1)},staticRenderFns:[]};var g=r("VU/8")(p,h,!1,function(e){r("ptuZ")},"data-v-adc97616",null);t.default=g.exports},ptuZ:function(e,t){}});